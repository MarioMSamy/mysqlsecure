# MariaDB Secure Setup Script for WooCommerce

This script automates the setup of a secure MariaDB server optimized for WooCommerce. It includes security configurations, performance optimizations, automated backups, and monitoring. The script is designed to be run on a fresh Ubuntu server and will configure MariaDB to allow remote access from specified IP addresses.

## Features

- **Security Enhancements**: Secures the MariaDB installation by removing anonymous users, securing the root account, and dropping the test database.
- **Performance Optimizations**: Configures MariaDB for optimal performance based on available server resources.
- **Automated Backups**: Sets up daily automated backups of the WooCommerce database.
- **Monitoring**: Configures weekly monitoring using `mysqltuner` and sends reports to a specified email address.
- **Remote Access**: Allows remote access to the MariaDB server from specified IP addresses.

## Prerequisites

- Ubuntu server (tested on Ubuntu 20.04 LTS)
- Root access to the server
- Basic knowledge of Linux command line

## Installation

1. **Download the Script**

   Use the following command to download the script:

   ```bash
   wget -O install_secure_mariadb_alerts.sh https://raw.githubusercontent.com/MarioMSamy/mysqlsecure/refs/heads/main/install_secure_mariadb_alerts.sh
   ```

2. **Make the Script Executable**

   Change the permissions of the script to make it executable:

   ```bash
   chmod +x install_secure_mariadb_alerts.sh
   ```

3. **Run the Script**

   Execute the script with root privileges:

   ```bash
   sudo ./install_secure_mariadb_alerts.sh
   ```

## Usage

### Input Prompts

The script will prompt you for the following information:

- **Email Address**: Enter your email address to receive alerts and monitoring reports.
- **MariaDB Root Password**: Enter a strong password for the MariaDB root user.
- **Database Name**: Enter the name of the WooCommerce database.
- **Database User**: Enter the username for the WooCommerce database.
- **Database Password**: Enter a strong password for the WooCommerce database user.
- **Remote Access IPs**: Enter the IP addresses that should be allowed to access the MariaDB server remotely. You can enter multiple IPs; leave the input blank to finish.
- **Backup Directory**: Enter the directory where MariaDB backups will be stored.

### Automated Backups

The script sets up a daily backup of the WooCommerce database at 2 AM. The backups are stored in the specified backup directory and are compressed using `gzip`.

### Monitoring

The script configures weekly monitoring using `mysqltuner`. The monitoring report is sent to the specified email address every week.

### Firewall Configuration

The script configures the firewall (`ufw`) to allow MariaDB traffic (port 3306) only from the specified IP addresses.

## Customization

You can customize the script by editing the following variables before running it:

- **Backup Directory**: Change the default backup directory by modifying the `DEFAULT_BACKUP_DIR` variable.
- **Performance Settings**: Adjust the MariaDB performance settings in the `99-woocommerce-optimized.cnf` file generated by the script.

## Logs

The script logs all actions to `/var/log/mariadb_woocommerce_setup.log`. Check this log file for any errors or warnings after running the script.

## Example

Here is an example of how to run the script:

```bash
wget -O install_secure_mariadb_alerts.sh https://raw.githubusercontent.com/MarioMSamy/mysqlsecure/refs/heads/main/install_secure_mariadb_alerts.sh
chmod +x install_secure_mariadb_alerts.sh
sudo ./install_secure_mariadb_alerts.sh
```

## Troubleshooting

- **Failed to Fix Broken Packages**: Ensure your system is up-to-date by running `sudo apt update && sudo apt upgrade` before running the script.
- **Firewall Issues**: If the firewall (`ufw`) is not active, the script will enable it. Ensure that the specified IP addresses are correct to avoid being locked out.
- **Backup Failures**: Check the backup script (`/usr/local/bin/mariadb_backup.sh`) and ensure that the backup directory has the correct permissions.

## Contributing

If you find any issues or have suggestions for improvements, please open an issue or submit a pull request on the [GitHub repository](https://github.com/MarioMSamy/mysqlsecure).

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

---

**Note**: This script is intended for use in a development or staging environment. Always test thoroughly before deploying to production.
